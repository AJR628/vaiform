# Route Truth Table (C1 Baseline, Code-Evidenced)

**Audit date**: 2026-02-18  
**Branch**: `feat/voice-ssot-tts`

Rules used in this table:

- **Envelope status applies only to JSON responses**.
- **Active = Default-Reachable AND Caller-Backed**.
- **Caller-Backed = called from files actually served by default runtime entrypoints (dist-first mode when `web/dist` exists)**.

Columns:

- `Gating`: `Default-Reachable`, `Legacy-Gated`, `Debug-Gated`, `Commented/Unmounted`, `Shadowed`.
- `Response`: `json`, `html`, `file`, `redirect`, `raw`, `empty`.

| Method | Path                      | Mounted in                 | Middleware chain (ordered)                                           | Handler                    | Auth                          | Response  | Gating                                                   | Default-Reachable | Caller-Backed                                                           | Active | Envelope status                                      | Evidence                                                                                                                                                                |
| ------ | ------------------------- | -------------------------- | -------------------------------------------------------------------- | -------------------------- | ----------------------------- | --------- | -------------------------------------------------------- | ----------------- | ----------------------------------------------------------------------- | ------ | ---------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| GET    | `/health`                 | `src/app.js:174`           | `reqId -> cors -> inline`                                            | inline health              | public                        | json      | Default-Reachable                                        | yes               | yes (ops/health)                                                        | yes    | Canonical (`ok`)                                     | `src/app.js:174-177`                                                                                                                                                    |
| HEAD   | `/health`                 | `src/app.js:178`           | `reqId -> cors -> inline`                                            | inline head                | public                        | empty     | Default-Reachable                                        | yes               | yes (ops/health)                                                        | yes    | n/a (non-json)                                       | `src/app.js:178-180`                                                                                                                                                    |
| POST   | `/diag/echo`              | `src/app.js:182`           | `reqId -> cors -> inline`                                            | inline diag echo           | public                        | json      | Debug-Gated                                              | no                | no                                                                      | no     | Canonical (`ok`)                                     | `src/app.js:182-190`                                                                                                                                                    |
| GET    | `/stripe/webhook`         | `/stripe/webhook`          | `reqId -> cors -> stripe router`                                     | alive check                | public                        | json      | Default-Reachable                                        | yes               | no                                                                      | no     | Drift (`ok`)                                         | `src/app.js:120`, `src/routes/stripe.webhook.js:144-145`                                                                                                                |
| POST   | `/stripe/webhook`         | `/stripe/webhook`          | `reqId -> cors -> express.raw -> webhook`                            | webhook handler            | public (signed)               | raw/json  | Default-Reachable                                        | yes               | yes (Stripe)                                                            | yes    | Drift (`ok` on error path)                           | `src/routes/stripe.webhook.js:12`, `src/routes/stripe.webhook.js:66`                                                                                                    |
| GET    | `/`                       | `/` healthRoutes           | `reqId -> cors -> healthRoutes`                                      | health root                | public                        | json      | Default-Reachable                                        | yes               | yes (browser root)                                                      | yes    | Drift (`message`)                                    | `src/app.js:211`, `src/routes/health.routes.js:10-19`                                                                                                                   |
| GET    | `/`                       | `/` whoamiRoutes           | `reqId -> cors -> requireAuth`                                       | whoami root                | required                      | json      | Shadowed (winner: `healthRoutes`)                        | no (practically)  | no                                                                      | no     | Drift (no requestId)                                 | `src/app.js:211-212`, `src/routes/whoami.routes.js:10-17`                                                                                                               |
| GET    | `/`                       | `/` creditsRoutes          | `reqId -> cors -> requireAuth`                                       | credits root               | required                      | json      | Shadowed                                                 | no (practically)  | no                                                                      | no     | Drift (manual json)                                  | `src/app.js:214`, `src/routes/credits.routes.js:11`                                                                                                                     |
| GET    | `/`                       | `/` routes.index           | `reqId -> cors -> index router`                                      | API root                   | public                        | json      | Shadowed                                                 | no (practically)  | no                                                                      | no     | Drift (`message`)                                    | `src/app.js:237`, `src/routes/index.js:24`                                                                                                                              |
| GET    | `/api`                    | `/api` healthRoutes        | `reqId -> cors -> healthRoutes`                                      | health root                | public                        | json      | Default-Reachable                                        | yes               | no                                                                      | no     | Drift (`message`)                                    | `src/app.js:219`, `src/routes/health.routes.js:10-19`                                                                                                                   |
| GET    | `/api`                    | `/api` whoamiRoutes        | `reqId -> cors -> requireAuth`                                       | whoami root                | required                      | json      | Shadowed (winner: `healthRoutes`)                        | no (practically)  | no                                                                      | no     | Drift (no requestId)                                 | `src/app.js:219-220`, `src/routes/whoami.routes.js:10-17`                                                                                                               |
| GET    | `/credits`                | direct app route           | `reqId -> cors -> getCreditsHandler`                                 | credits handler            | required (manual token check) | json      | Default-Reachable                                        | yes               | no (root path is conditional fallback only for GET on `/api/*` 404)     | no     | Canonical (`ok/fail`)                                | `src/app.js:222`, `src/handlers/credits.get.js:8-29`, `web/dist/api.mjs:156-163`                                                                                        |
| GET    | `/api/credits`            | direct app route           | `reqId -> cors -> getCreditsHandler`                                 | credits handler            | required (manual token check) | json      | Default-Reachable                                        | yes               | yes (`apiFetch(\"/credits\")` from dist clients maps to `/api/credits`) | yes    | Canonical (`ok/fail`)                                | `src/app.js:229`, `src/handlers/credits.get.js:8-29`, `web/dist/frontend.js:140`, `web/dist/creative.html:1183`, `web/dist/js/my-images.js:132`, `web/dist/api.mjs:152` |
| POST   | `/generate`               | `/` generateRoutes         | `reqId -> cors -> requireAuth -> idempotency -> validate`            | generate                   | required                      | json      | Default-Reachable                                        | yes               | no (`apiFetch(\"/generate\")` callers target `/api/generate`)           | no     | Drift (`message` in controller)                      | `src/routes/generate.routes.js:11`, `web/dist/frontend.js:490`, `web/dist/creative.html:2443`, `web/dist/api.mjs:152`                                                   |
| POST   | `/api/generate`           | `/api` generateRoutes      | `reqId -> cors -> requireAuth -> idempotency -> validate`            | generate                   | required                      | json      | Default-Reachable                                        | yes               | yes (`apiFetch(\"/generate\")` from dist callers)                       | yes    | Drift (`message` in controller)                      | `src/app.js:223`, `src/routes/generate.routes.js:11`, `web/dist/frontend.js:490`, `web/dist/creative.html:2120`, `web/dist/api.mjs:152`                                 |
| GET    | `/job/:jobId`             | `/` generateRoutes         | `reqId -> cors -> requireAuth`                                       | job status                 | required                      | json      | Default-Reachable                                        | yes               | no (`apiFetch(\"/job/:jobId\")` callers target `/api/job/:jobId`)       | no     | Drift (`message` in controller)                      | `src/routes/generate.routes.js:12`, `web/dist/js/my-images.js:378`, `web/dist/api.mjs:152`                                                                              |
| GET    | `/api/job/:jobId`         | `/api` generateRoutes      | `reqId -> cors -> requireAuth`                                       | job status                 | required                      | json      | Default-Reachable                                        | yes               | yes (`apiFetch(\"/job/:jobId\")` from dist callers)                     | yes    | Drift (`message` in controller)                      | `src/app.js:223`, `src/routes/generate.routes.js:12`, `web/dist/js/my-images.js:378`, `web/dist/api.mjs:152`                                                            |
| GET    | `/generate`               | direct app guard           | `reqId -> cors -> inline`                                            | 405 guard                  | public                        | json      | Default-Reachable                                        | yes               | no                                                                      | no     | Canonical (`fail`)                                   | `src/app.js:237-239`                                                                                                                                                    |
| POST   | `/enhance`                | `/` and `/enhance`         | `reqId -> cors -> requireAuth -> validate`                           | enhance                    | required                      | json      | Default-Reachable                                        | yes               | no (`apiFetch(\"/enhance\")` callers target `/api/enhance`)             | no     | Mixed/manual (not `ok/fail`)                         | `src/app.js:241-243`, `src/routes/enhance.routes.js:28-31`, `web/dist/frontend.js:272`, `web/dist/api.mjs:152`                                                          |
| POST   | `/api/enhance`            | `/api`                     | `reqId -> cors -> requireAuth -> validate`                           | enhance                    | required                      | json      | Default-Reachable                                        | yes               | yes (`apiFetch(\"/enhance\")` from dist callers)                        | yes    | Mixed/manual (not `ok/fail`)                         | `src/app.js:243`, `src/routes/enhance.routes.js:28`, `web/dist/frontend.js:272`, `web/dist/api.mjs:152`                                                                 |
| POST   | `/checkout/start`         | `/checkout`                | `reqId -> cors -> requireAuth`                                       | startPlanCheckout          | required                      | json      | Default-Reachable                                        | yes               | yes (`web/dist/js/pricing.js`)                                          | yes    | Drift (`ok/reason`)                                  | `src/app.js:247`, `src/routes/checkout.routes.js:16`, `web/dist/js/pricing.js:138`                                                                                      |
| POST   | `/api/start`              | `/api`                     | `reqId -> cors -> requireAuth`                                       | startPlanCheckout          | required                      | json      | Default-Reachable                                        | yes               | no proven default caller                                                | no     | Drift (`ok/reason`)                                  | `src/app.js:248`, `src/routes/checkout.routes.js:16`                                                                                                                    |
| POST   | `/checkout/session`       | `/checkout`                | `reqId -> cors -> requireAuth -> validate`                           | createCheckoutSession      | required                      | json      | Default-Reachable                                        | yes               | no proven default caller                                                | no     | Drift (`ok/reason`)                                  | `src/routes/checkout.routes.js:20`                                                                                                                                      |
| POST   | `/api/session`            | `/api`                     | `reqId -> cors -> requireAuth -> validate`                           | createCheckoutSession      | required                      | json      | Default-Reachable                                        | yes               | yes (`web/dist/js/buy-credits.js`)                                      | yes    | Drift (`ok/reason`)                                  | `src/app.js:248`, `src/routes/checkout.routes.js:20`, `web/dist/js/buy-credits.js:40`, `web/dist/api.mjs:152`                                                           |
| POST   | `/checkout/subscription`  | `/checkout`                | `reqId -> cors -> requireAuth -> validate`                           | createSubscriptionSession  | required                      | json      | Default-Reachable                                        | yes               | no proven default caller                                                | no     | Drift (`ok/reason`)                                  | `src/routes/checkout.routes.js:23`                                                                                                                                      |
| POST   | `/api/subscription`       | `/api`                     | `reqId -> cors -> requireAuth -> validate`                           | createSubscriptionSession  | required                      | json      | Default-Reachable                                        | yes               | yes (`web/dist/js/buy-credits.js`)                                      | yes    | Drift (`ok/reason`)                                  | `src/app.js:248`, `src/routes/checkout.routes.js:23`, `web/dist/js/buy-credits.js:52`, `web/dist/api.mjs:152`                                                           |
| POST   | `/checkout/portal`        | `/checkout`                | `reqId -> cors -> requireAuth`                                       | createBillingPortalSession | required                      | json      | Default-Reachable                                        | yes               | no proven default caller                                                | no     | Drift (`ok/reason`)                                  | `src/routes/checkout.routes.js:26`                                                                                                                                      |
| POST   | `/api/portal`             | `/api`                     | `reqId -> cors -> requireAuth`                                       | createBillingPortalSession | required                      | json      | Default-Reachable                                        | yes               | yes (`web/dist/js/buy-credits.js`)                                      | yes    | Drift (`ok/reason`)                                  | `src/app.js:248`, `src/routes/checkout.routes.js:26`, `web/dist/js/buy-credits.js:123`, `web/dist/api.mjs:152`                                                          |
| GET    | `/api/shorts/mine`        | `/api/shorts`              | `reqId -> cors -> requireAuth`                                       | getMyShorts                | required                      | json      | Default-Reachable                                        | yes               | yes (`web/dist/js/my-shorts.js`)                                        | yes    | Drift (`message`)                                    | `src/routes/shorts.routes.js:12`, `web/dist/js/my-shorts.js:35`                                                                                                         |
| GET    | `/api/shorts/:jobId`      | `/api/shorts`              | `reqId -> cors -> requireAuth`                                       | getShortById               | required                      | json      | Default-Reachable                                        | yes               | yes (`web/dist/js/my-shorts.js`)                                        | yes    | Drift (`message`)                                    | `src/routes/shorts.routes.js:13`, `web/dist/js/my-shorts.js:172`                                                                                                        |
| GET    | `/cdn`                    | `/cdn`                     | `reqId -> cors -> cdnRateLimit`                                      | CDN proxy                  | public                        | file/json | Default-Reachable                                        | yes               | yes (`web/dist/creative.html`)                                          | yes    | Mixed/manual                                         | `src/app.js:257`, `src/routes/cdn.routes.js:21`, `web/dist/creative.html:2253`                                                                                          |
| POST   | `/api/assets/options`     | `/api/assets`              | `reqId -> cors -> requireAuth -> validate`                           | getAssetsOptions           | required                      | json      | Default-Reachable                                        | yes               | yes (`web/dist/creative.html`)                                          | yes    | Canonical (`ok/fail`)                                | `src/routes/assets.routes.js:10`, `src/controllers/assets.controller.js:17-89`, `web/dist/creative.html:1266`                                                           |
| POST   | `/api/assets/ai-images`   | `/api/assets`              | `reqId -> cors -> requireAuth`                                       | disabled via `fail(410)`   | required                      | json      | Default-Reachable                                        | yes               | no (legacy `creative.html` callers only; not canonical `/creative`)     | no     | Canonical (`fail`, includes `requestId`)             | `src/routes/assets.routes.js:12-20`, `src/controllers/assets.controller.js:98-105`, `web/dist/creative.html:2229`                                                       |
| GET    | `/api/limits/usage`       | `/api/limits`              | `reqId -> cors -> requireAuth`                                       | getUsageLimits             | required                      | json      | Default-Reachable                                        | yes               | no default caller                                                       | no     | Drift (`ok/reason`)                                  | `src/app.js:279`, `src/routes/limits.routes.js:7`, `src/controllers/limits.controller.js:7-64`                                                                          |
| GET    | `/limits/usage`           | `/limits`                  | `reqId -> cors -> requireAuth`                                       | getUsageLimits             | required                      | json      | Default-Reachable                                        | yes               | no default caller                                                       | no     | Drift (`ok/reason`)                                  | `src/app.js:280`, `src/routes/limits.routes.js:7`                                                                                                                       |
| GET    | `/creative`               | `/creative`                | `reqId -> cors -> creative router`                                   | send creative HTML         | public                        | file      | Default-Reachable                                        | yes               | yes (index/header default links now target `/creative`)                 | yes    | n/a (non-json)                                       | `src/app.js:298`, `src/routes/creative.routes.js:11-13`, `web/dist/components/header.js:13`, `web/dist/index.html:40`, `web/dist/index.html:142`                        |
| POST   | `/api/story/*`            | `/api/story`               | `reqId -> cors -> requireAuth -> route-specific guards`              | story handlers             | required                      | json      | Default-Reachable                                        | yes               | yes (canonical `/creative` article flow)                                | yes    | Canonical (C4 pass; manual finalize/busy exceptions) | `src/app.js:312`, `src/routes/story.routes.js:32`, `public/js/pages/creative/creative.article.mjs:1091-3921`                                                            |
| POST   | `/api/caption/preview`    | `/api`                     | `reqId -> cors -> requireAuth -> previewRateLimit -> json(200kb)`    | caption preview            | required                      | json      | Default-Reachable                                        | yes               | yes (canonical `/creative` uses `public/js/caption-preview.js`)         | yes    | Canonical (`ok/fail`)                                | `src/app.js:318`, `src/routes/caption.preview.routes.js:109`, `public/js/caption-preview.js:636`, `public/js/caption-preview.js:1165`                                   |
| GET    | `/api/diag/caption-smoke` | `/api`                     | gate middleware then `requireAuth`                                   | smoke route                | required                      | json      | Debug-Gated                                              | no                | no                                                                      | no     | Canonical on success path                            | `src/routes/caption.preview.routes.js:1219-1245`                                                                                                                        |
| POST   | `/api/user/setup`         | `/api/user` + inline alias | `reqId -> cors -> requireAuth` (router wins)                         | userRoutes setup           | required                      | json      | Default-Reachable (inline alias is Shadowed/Unreachable) | yes               | no clear default caller                                                 | no     | Drift (`ok/reason` in router)                        | `src/app.js:321`, `src/routes/user.routes.js:12-29`, `src/app.js:330-333`                                                                                               |
| GET    | `/api/user/me`            | `/api/user`                | `reqId -> cors -> requireAuth`                                       | fetch user profile         | required                      | json      | Default-Reachable                                        | yes               | no clear default caller                                                 | no     | Drift (`ok/reason`)                                  | `src/routes/user.routes.js:40-67`                                                                                                                                       |
| POST   | `/api/users/ensure`       | `/api/users`               | `reqId -> cors -> requireAuth`                                       | ensure user doc            | required                      | json      | Default-Reachable                                        | yes               | no proven dist-entrypoint caller                                        | no     | Mixed/manual (no requestId)                          | `src/app.js:326`, `src/routes/users.routes.js:14-100`, `web/dist/js/firebaseClient.js:23-53`                                                                            |
| POST   | `/api/uploads/image`      | `/api` uploads router      | `reqId -> cors -> requireAuth -> uploadRateLimit -> multer`          | upload image               | required                      | json      | Legacy-Gated                                             | no                | legacy caller only                                                      | no     | Drift (`message`)                                    | `src/app.js:259-262`, `src/routes/uploads.routes.js:42-71`                                                                                                              |
| POST   | `/api/uploads/register`   | `/api` uploads router      | `reqId -> cors -> requireAuth -> uploadRateLimit`                    | register upload URL        | required                      | json      | Legacy-Gated                                             | no                | legacy caller only                                                      | no     | Drift (`message`)                                    | `src/app.js:259-262`, `src/routes/uploads.routes.js:78-90`                                                                                                              |
| GET    | `/api/voice/voices`       | `/api/voice`               | `reqId -> cors -> requireAuth`                                       | getVoices                  | required                      | json      | Legacy-Gated                                             | no                | legacy caller only                                                      | no     | Drift (`message`)                                    | `src/app.js:283-287`, `src/routes/voice.routes.js:7`                                                                                                                    |
| POST   | `/api/voice/preview`      | `/api/voice`               | `reqId -> cors -> requireAuth`                                       | previewVoice               | required                      | json      | Legacy-Gated                                             | no                | legacy caller only                                                      | no     | Drift (`message`)                                    | `src/app.js:283-287`, `src/routes/voice.routes.js:8`                                                                                                                    |
| POST   | `/api/tts/preview`        | `/api/tts`                 | `reqId -> cors -> requireAuth -> ttsPreviewRateLimit -> json(200kb)` | ttsPreview                 | required                      | json      | Legacy-Gated                                             | no                | legacy caller only                                                      | no     | Mixed/manual                                         | `src/app.js:298-301`, `src/routes/tts.routes.js:24`                                                                                                                     |
| POST   | `/api/caption/render`     | `/api`                     | `reqId -> cors -> requireAuth -> renderRateLimit -> json(200kb)`     | caption render             | required                      | json      | Legacy-Gated                                             | no                | legacy caller only                                                      | no     | Drift (manual + flatten detail object)               | `src/app.js:314-317`, `src/routes/caption.render.routes.js:26-109`                                                                                                      |
| GET    | `/diag/*`                 | `/diag`                    | `reqId -> cors -> diagRoutes`                                        | diagnostic routes          | public                        | json      | Debug-Gated                                              | no                | no                                                                      | no     | Drift (`ok`)                                         | `src/app.js:216`, `src/routes/diag.routes.js:10-108`                                                                                                                    |
| GET    | `/api/diag/headers`       | `/api`                     | `reqId -> cors -> diagHeadersRoutes`                                 | headers diag               | public                        | json      | Debug-Gated                                              | no                | no                                                                      | no     | Mixed/manual                                         | `src/app.js:225-227`                                                                                                                                                    |
| Any    | `/api/studio/*`           | commented                  | n/a                                                                  | studio routes              | n/a                           | json/SSE  | Commented/Unmounted                                      | no                | no proven dist-entrypoint caller (unreferenced bundle strings excluded) | no     | n/a                                                  | `src/app.js:264-267`                                                                                                                                                    |
| Any    | `/api/quotes/*`           | commented                  | n/a                                                                  | quotes routes              | n/a                           | json      | Commented/Unmounted                                      | no                | no (default dist callers are gated)                                     | no     | n/a                                                  | `src/app.js:269-273`, `web/dist/creative.html:906-935`, `web/dist/creative.html:1201-1203`, `web/dist/creative.html:2082-2083`                                          |
| Any    | `/api/preview/*`          | commented                  | n/a                                                                  | preview routes             | n/a                           | json      | Commented/Unmounted                                      | no                | no default caller                                                       | no     | n/a                                                  | `src/app.js:294-297`                                                                                                                                                    |

## CI Truth (Enforced vs Observed)

- **Enforced in CI**:
  - `npm run format:check` (`.github/workflows/ci.yml:35-36`)
  - `npm run test:security` (`.github/workflows/ci.yml:38-39`)
  - `npm run check:responses:changed` (`.github/workflows/ci.yml:41-45`)
- **Observed baseline (not CI-blocking)**:
  - `node scripts/check-responses.js` for repo-wide drift baseline.

## Broken Caller Attempts (Caller-Backed but NOT Default-Reachable)

- None currently proven in default dist entrypoint callers after C3 hardening.
- Checkout callers now target mounted `/api/session|subscription|portal` paths (`web/dist/js/buy-credits.js:40`, `web/dist/js/buy-credits.js:52`, `web/dist/js/buy-credits.js:123`, `src/app.js:248`).
- Upscale/quotes/voice/uploads/shorts-create caller paths are gated in default dist runtime (`web/dist/js/my-images.js:205-213`, `web/dist/frontend.js:525-528`, `web/dist/creative.html:906-935`, `web/dist/creative.html:1201-1203`, `web/dist/creative.html:2025-2026`, `web/dist/creative.html:2077-2083`, `web/dist/creative.html:2269-2276`).

## Notes on Precedence

- Ordered root mounts create practical shadowing on `GET /`:
  - `healthRoutes` mounted before `whoamiRoutes`, `creditsRoutes`, and `routes.index` (`src/app.js:211`, `src/app.js:212`, `src/app.js:214`, `src/app.js:237`).
- Credits has dual implementation on same paths:
  - router mount + direct `app.get` (`src/app.js:214-215`, `src/app.js:221-222`).
