[build]
base = "web"
publish = "dist"
# One-time debug: print package.json that Netlify sees, then build
command = "echo '--- PWD ---' && pwd && echo '--- LS ---' && ls -la && echo '--- /web/package.json ---' && cat package.json && echo '--- npm run (list) ---' && npm run || true && npm ci && echo '--- vite version ---' && npx vite --version || true && npm run build"

# proxy to Replit backend
[[redirects]]
  from = "/api/*"
  to = "https://17e0d1d1-e327-483d-b1ea-c41bea08fb59-00-1ef93t84nlhq6.janeway.replit.dev/:splat"
  status = 200
  force = true

[[redirects]]
  from = "/stripe/webhook"
  to = "https://17e0d1d1-e327-483d-b1ea-c41bea08fb59-00-1ef93t84nlhq6.janeway.replit.dev/stripe/webhook"
  status = 200
  force = true

# SPA fallback
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# Correct headers syntax: array item with nested values
[[headers]]
  for = "/*"
  [headers.values]
    Cache-Control = "no-store"